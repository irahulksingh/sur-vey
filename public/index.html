<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enkätundersökning</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <!-- Language Toggle -->
    <div id="language-toggle">
      <label for="language-select">Language:</label>
      <select id="language-select">
        <option value="sv" selected>Swedish</option>
        <option value="en">English</option>
      </select>
    </div>

    <h1 id="survey-title">Enkätundersökning</h1>
    
    <!-- Survey Form -->
    <form id="survey-form"></form>
    <button id="submit-btn" class="submit-btn" style="display:none;">Skicka</button>
    
    <!-- Results Section -->
    <div id="results-table">
      <h2 id="results-title" style="display: none;">Resultat</h2>
      <table id="ranksTable" style="display: none; width: 100%; border-collapse: collapse;">
        <thead>
          <tr>
            <th>Rank 1</th>
            <th>Rank 2</th>
            <th>Rank 3</th>
            <th>Rank 4</th>
            <th>Rank 5</th>
          </tr>
        </thead>
        <tbody>
          <!-- Rows will be dynamically added here -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    // Function to dynamically load the survey form
    const loadSurveyForm = () => {
      const surveyForm = document.getElementById("survey-form");
      surveyForm.innerHTML = `
        <!-- Add your form fields dynamically here -->
        <label for="question1">Fråga 1:</label>
        <input type="text" id="question1" name="question1"><br>
        <label for="question2">Fråga 2:</label>
        <input type="text" id="question2" name="question2"><br>
      `;
      document.getElementById("submit-btn").style.display = "block";
    };

    // Function to handle survey submission
    const submitSurvey = async () => {
      const formData = {
        question1: document.getElementById("question1").value,
        question2: document.getElementById("question2").value
      };

      try {
        // Submit survey data to the backend
        const response = await fetch('/api/submit', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData)
        });

        if (response.ok) {
          // Load the ranks table after a successful submission
          loadRanksTable();
        } else {
          console.error("Failed to submit survey.");
        }
      } catch (error) {
        console.error("Error submitting survey:", error);
      }
    };

    // Function to fetch and display ranks
    const loadRanksTable = async () => {
      try {
        const response = await fetch('/api/ranks'); // Fetch ranks data from the backend
        const ranksData = await response.json();

        const table = document.getElementById("ranksTable");
        const tableBody = table.querySelector("tbody");
        tableBody.innerHTML = ""; // Clear existing rows

        // Populate the table with ranks data
        ranksData.forEach(rankObj => {
          const row = document.createElement("tr");
          rankObj.ranks.forEach(rank => {
            const cell = document.createElement("td");
            cell.textContent = rank;
            row.appendChild(cell);
          });
          tableBody.appendChild(row);
        });

        // Show the results table
        document.getElementById("results-title").style.display = "block";
        table.style.display = "table";
      } catch (error) {
        console.error("Error fetching ranks:", error);
      }
    };

    // Event Listeners
    document.getElementById("submit-btn").addEventListener("click", (event) => {
      event.preventDefault();
      submitSurvey();
    });

    // Language toggle functionality
    document.getElementById("language-select").addEventListener("change", (event) => {
      const selectedLanguage = event.target.value;
      const title = document.getElementById("survey-title");
      const button = document.getElementById("submit-btn");

      if (selectedLanguage === "sv") {
        title.textContent = "Enkätundersökning";
        button.textContent = "Skicka";
      } else if (selectedLanguage === "en") {
        title.textContent = "Survey";
        button.textContent = "Submit";
      }
    });

    // Load the survey form on page load
    window.onload = loadSurveyForm;
  </script>
</body>
</html>